{% extends "base.html" %}
{% block title %}Book a Service - MotorCare{% endblock %}

{% block content %}
<div class="container my-5">
  <h2 class="text-center mb-4 fw-bold">Book a Service</h2>

  <div class="booking-flex">
    <!-- === Booking Form Section === -->
    <div class="form-section">
      <form method="POST" id="bookingForm">
        {{ form.hidden_tag() }}

        <div class="mb-3">
          {{ form.customer_name.label(class="form-label fw-semibold") }}
          {{ form.customer_name(class="form-control", placeholder="Enter your name") }}
        </div>

        <div class="mb-3">
          {{ form.phone.label(class="form-label fw-semibold") }}
          {{ form.phone(class="form-control", placeholder="Enter phone number") }}
        </div>

        <div class="mb-3">
          {{ form.email.label(class="form-label fw-semibold") }}
          {{ form.email(class="form-control", placeholder="Enter email address") }}
        </div>

        <div class="mb-3">
          {{ form.vehicle_model.label(class="form-label fw-semibold") }}
          {{ form.vehicle_model(class="form-control", placeholder="e.g. Honda Activa 5G") }}
        </div>

        <div class="mb-3">
          {{ form.registration_no.label(class="form-label fw-semibold") }}
          {{ form.registration_no(class="form-control", placeholder="e.g. MH12AB1234") }}
        </div>

        <!-- === Service Selection === -->
        <div class="mb-3">
          <label class="form-label fw-semibold">Select Services</label><br />
          <button type="button" class="btn btn-outline-primary" id="openServicePopup">
            Choose Services
          </button>
          <input type="hidden" id="selectedServicesInput" name="selected_services" />

          <!-- Inline selected services box -->
          <div id="selectedServicesBox" class="selected-services-textarea mt-2">
            <div class="text-muted small text-center">No services selected yet</div>
          </div>
        </div>

        <div class="mb-3">
          {{ form.date.label(class="form-label fw-semibold") }}
          {{ form.date(class="form-control", placeholder="dd-mm-yyyy") }}
        </div>

        <div class="mb-3">
          {{ form.time_slot.label(class="form-label fw-semibold") }}
          {{ form.time_slot(class="form-control", placeholder="e.g. 10:00 AM") }}
        </div>

        <div class="mb-3">
          {{ form.notes.label(class="form-label fw-semibold") }}
          {{ form.notes(class="form-control", rows="3", placeholder="Add any notes or issues...") }}
        </div>

        <button type="submit" class="btn btn-primary w-100 py-2 fw-semibold">
          Book Service
        </button>
      </form>
    </div>
  </div>
</div>

<!-- ==============================
     POPUP FOR SERVICE SELECTION
================================= -->
<div class="service-popup" id="servicePopup">
  <div class="service-popup-content shadow">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h5 class="fw-bold">Choose Services</h5>
      <button class="btn-close" id="closeServicePopup"></button>
    </div>

    <input type="text" id="serviceSearch" class="form-control mb-3" placeholder="Search service..." />

    <!-- Service Cards -->
    <div class="d-flex flex-column gap-2">
      {% for service in form.services.choices %}
      <label class="d-flex align-items-center service-card border rounded p-2">
        <input
          type="checkbox"
          class="form-check-input me-2 service-checkbox"
          value="{{ service[0] }}"
        />
        <span>{{ service[1] }}</span>
      </label>
      {% endfor %}
    </div>

    <div class="mt-4 d-flex justify-content-end gap-2">
      <button class="btn btn-secondary" id="cancelServicePopup">Cancel</button>
      <button class="btn btn-primary" id="confirmServiceSelection">Confirm</button>
    </div>
  </div>
</div>
<!-- ==============================
     SUCCESS POPUP (FULL SCREEN)
================================= -->
<div id="bookingSuccessPopup" class="booking-success-overlay">
  <div class="booking-success-content">
    <div class="checkmark-circle">
      <div class="checkmark draw"></div>
    </div>
    <h3 class="mt-3 fw-bold text-center">Booking Successful!</h3>
    <p class="text-center mb-4">Your booking has been successfully submitted to <strong>Prasad Auto Parts</strong>.</p>
    <button id="closeSuccessPopup" class="btn btn-primary px-4 py-2">OK</button>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="{{ url_for('static', filename='js/main.js') }}"></script>
{% endblock %}
